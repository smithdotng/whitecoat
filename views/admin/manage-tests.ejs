<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title><%= pageTitle %> - Medical Lab</title>

    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/all.min.css">
    <link rel="stylesheet" href="/assets/css/animate.css">
    <link rel="stylesheet" href="/assets/css/nice-select.css">
    <link rel="stylesheet" href="/assets/css/slick.css">
    <link rel="stylesheet" href="/assets/css/slick-theme.css">
    <link rel="stylesheet" href="/assets/css/odometer.css">
    <link rel="stylesheet" href="/assets/css/magnific-popup.css">
    <link rel="stylesheet" href="/assets/css/flaticon.css">
    <link rel="stylesheet" href="/assets/css/main.css">

    <link rel="shortcut icon" href="/assets/images/favicon.png" type="image/x-icon">

    <style>
        .test-card {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid;
            transition: all 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .test-card.blood { border-left-color: #dc3545; }
        .test-card.urine { border-left-color: #007bff; }
        .test-card.panel { border-left-color: #28a745; }
        .test-card.hormone { border-left-color: #ffc107; }
        .test-card.std { border-left-color: #6f42c1; }
        .test-card.other { border-left-color: #6c757d; }
        
        .test-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-right: 5px;
        }
        
        .badge-blood { background-color: #f8d7da; color: #721c24; }
        .badge-urine { background-color: #d1ecf1; color: #0c5460; }
        .badge-panel { background-color: #d4edda; color: #155724; }
        .badge-hormone { background-color: #fff3cd; color: #856404; }
        .badge-std { background-color: #e2d9f3; color: #422874; }
        .badge-other { background-color: #f8f9fa; color: #343a40; }
        
        .test-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #28a745;
        }
        
        .test-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-active { background-color: #d4edda; color: #155724; }
        .status-inactive { background-color: #f8d7da; color: #721c24; }
        
        .test-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 48px;
            color: #ddd;
            margin-bottom: 20px;
        }
        
        .search-filter {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-info {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .test-info i {
            width: 20px;
            color: #007bff;
        }
        
        .package-indicator {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-left: 5px;
        }
    </style>
</head>

<body>
    <!-- ==========Preloader Overlay Starts Here========== -->
    
    <div class="scrollToTop"><i class="fas fa-angle-up"></i></div>
    <div class="overlay"></div>
    <div class="overlayTwo"></div>
    <!-- ==========Preloader Overlay Ends Here========== -->

    <!-- ==========Header Section Starts Here========== -->
    <header>
        <div class="header-top">
            <div class="container">
                <div class="header-top-area">
                    <ul class="left">
                        <li>
                            <i class="far fa-clock"></i> Always Live
                        </li>
                        <li>
                            <a href="#"><i class="fas fa-phone-alt"></i>+234 701 403 2350</a>
                        </li>
                        <li>
                            <i class="fas fa-map-marker-alt"></i> Abuja FCT
                        </li>
                    </ul>
                    <ul class="social-icons">
                        <li>
                            <a href="#"><i class="fab fa-facebook-messenger"></i></a>
                        </li>
                        <li>
                            <a href="#"><i class="fab fa-twitter"></i></a>
                        </li>
                        <li>
                            <a href="#"><i class="fab fa-vimeo-v"></i></a>
                        </li>
                        <li>
                            <a href="#"><i class="fab fa-skype"></i></a>
                        </li>
                        <li>
                            <a href="#"><i class="fas fa-wifi"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="header-bottom">
            <div class="container">
                <div class="header-wrapper">
                    <div class="logo">
                        <a href="/">
                            <img src="/assets/images/logo/logo.png" alt="logo">
                        </a>
                    </div>
                    <div class="menu-area">
                        <ul class="menu">
                            <li><a href="/admin/dashboard">Admin Dashboard</a></li>
                            <li><a href="/admin/add-test">Add Test</a></li>
                            <li><a href="/admin/manage-tests" class="admin-menu-active">Manage Tests</a></li>
                            <li><a href="/admin/view-tests">View Tests</a></li>
                            <li><a href="/admin/view-requests">Patient Requests</a></li>
                            <li><a href="/admin/create-admin">Add Staff</a></li>
                            <li><a href="/logout">Logout</a></li>
                        </ul>
                        <div class="search-button">
                            <a href="#">
                                <i class="fas fa-search"></i>
                            </a>
                        </div>
                        <div class="header-bar d-lg-none">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <div class="ellepsis-bar d-lg-none">
                            <i class="fas fa-ellipsis-h"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- ==========Header Section Ends Here========== -->

    <!-- ===========Header Search=========== -->
    <div class="header-form">
        <div class="bg-lay">
            <div class="cross">
                <i class="fas fa-times"></i>
            </div>
        </div>
        <form class="form-container">
            <input type="text" placeholder="Input Your Search" name="name">
            <button type="submit">Search</button>
        </form>
    </div>
    <!-- ===========Header Search=========== -->

    <!-- ===========Header Cart=========== -->
    <div class="cart-sidebar-area">
        <div class="top-content">
            <a href="/" class="logo">
                <img src="/assets/images/logo/logo.png" alt="logo">
            </a>
            <span class="side-sidebar-close-btn"><i class="fas fa-times"></i></span>
        </div>
        <div class="bottom-content">
            <div class="cart-products">
                <h4 class="title">Shopping cart</h4>
                <div class="single-product-item">
                    <div class="thumb">
                        <img src="/assets/images/shop/01.png" alt="shop">
                    </div>
                    <div class="content">
                        <h4 class="title">Color Pencil</h4>
                        <div class="price"><span class="pprice">$80.00</span> <del class="dprice">$120.00</del></div>
                        <a href="#" class="remove-cart">Remove</a>
                    </div>
                </div>
                <div class="btn-wrapper text-center">
                    <a href="#" class="custom-button"><span>Checkout</span></a>
                </div>
            </div>
        </div>
    </div>
    <!-- ===========Header Cart=========== -->

    <!-- ==========Banner Section Starts Here========== -->
    <section class="page-header bg_img" data-background="/assets/images/banner/page-header.jpg">
        <div class="container">
            <div class="page-header-content">
                <h1 class="title">Manage Medical Tests</h1>
                <ul class="breadcrumb">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    <li>
                        <a href="/admin/dashboard">Admin</a>
                    </li>
                    <li>
                        Manage Tests
                    </li>
                </ul>
            </div>
        </div>
    </section>
    <!-- ==========Banner Section Ends Here========== -->

    <!-- ==========Manage Tests Section Starts Here========== -->
    <section class="events-single-section padding-top padding-bottom">
        <div class="container">
            <!-- Search and Filter -->
            <div class="search-filter">
                <div class="row">
                    <div class="col-md-6">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Search tests by name..." id="searchTests">
                            <div class="input-group-append">
                                <button class="btn btn-primary" type="button">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <select class="form-control" id="filterCategory">
                            <option value="">All Categories</option>
                            <option value="blood">Blood Tests</option>
                            <option value="urine">Urine Tests</option>
                            <option value="panel">Test Panels</option>
                            <option value="hormone">Hormone Tests</option>
                            <option value="std">STD Tests</option>
                            <option value="other">Other Tests</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-control" id="filterStatus">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Tests List -->
            <% if (tests && tests.length > 0) { %>
                <div class="row" id="testsList">
                    <% tests.forEach(test => { %>
                    <div class="col-lg-6 mb-4">
                        <div class="test-card <%= test.category %>">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h5>
                                        <%= test.name %>
                                        <% if (test.isPackage) { %>
                                            <span class="package-indicator">Package</span>
                                        <% } %>
                                    </h5>
                                    <div class="test-info">
                                        <i class="fas fa-tag"></i> 
                                        <span class="test-badge badge-<%= test.category %>">
                                            <%= test.category.charAt(0).toUpperCase() + test.category.slice(1) %>
                                        </span>
                                        <span class="test-status <%= test.isActive ? 'status-active' : 'status-inactive' %>">
                                            <%= test.isActive ? 'Active' : 'Inactive' %>
                                        </span>
                                    </div>
                                    <div class="test-info">
                                        <i class="fas fa-dollar-sign"></i> 
                                        <span class="test-price">$<%= test.price %></span>
                                    </div>
                                    <div class="test-info">
                                        <i class="far fa-clock"></i> Turnaround: <%= test.turnaroundTime %>
                                    </div>
                                    <div class="test-info">
                                        <i class="far fa-calendar"></i> Created: <%= new Date(test.createdAt).toLocaleDateString() %>
                                    </div>
                                </div>
                                <div class="col-md-4 text-right">
                                    <div class="test-actions">
                                        <a href="/admin/edit-test/<%= test._id %>" class="btn btn-primary btn-sm">
                                            <i class="fas fa-edit"></i> Edit
                                        </a>
                                        <form action="/admin/delete-test/<%= test._id %>" method="POST" class="d-inline" onsubmit="return confirmDelete()">
                                            <button type="submit" class="btn btn-danger btn-sm">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        </form>
                                    </div>
                                    <div class="mt-2">
                                        <a href="#" class="btn btn-outline-info btn-sm" onclick="viewTestDetails('<%= test._id %>')">
                                            <i class="fas fa-eye"></i> View
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <% if (test.isPackage && test.items && test.items.length > 0) { %>
                                <div class="mt-3 pt-3 border-top">
                                    <small class="text-muted">
                                        <i class="fas fa-boxes"></i> 
                                        Includes <%= test.items.length %> test(s)
                                    </small>
                                </div>
                            <% } %>
                        </div>
                    </div>
                    <% }); %>
                </div>
            <% } else { %>
                <div class="empty-state">
                    <i class="fas fa-vial"></i>
                    <h4>No Tests Found</h4>
                    <p>There are no medical tests in the system yet.</p>
                    <a href="/admin/add-test" class="btn btn-primary mt-3">
                        <i class="fas fa-plus"></i> Add Your First Test
                    </a>
                </div>
            <% } %>
            
            <!-- Test Details Modal -->
            <div class="modal fade" id="testDetailsModal" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Test Details</h5>
                            <button type="button" class="close" data-dismiss="modal">
                                <span>&times;</span>
                            </button>
                        </div>
                        <div class="modal-body" id="testDetailsContent">
                            <!-- Details will be loaded here -->
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- ==========Manage Tests Section Ends Here========== -->

    <!-- ==========Footer Section Starts Here========== -->
    <footer>
        <div class="footer-top">
            <div class="ft-top">
                <div class="container">
                    <div class="row no-gutters justify-content-center">
                        <div class="col-lg-4 col-sm-6 col-12">
                            <div class="ftt-item">
                                <div class="ftt-inner">
                                    <div class="ftt-thumb">
                                        <img src="/assets/images/footer/icon/01.png" alt="footer-icon">
                                    </div>
                                    <div class="ftt-content">
                                        <p class="mb-0">Phone Number : +800-123-4567 6587</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-sm-6 col-12">
                            <div class="ftt-item">
                                <div class="ftt-inner">
                                    <div class="ftt-thumb">
                                        <img src="/assets/images/footer/icon/02.png" alt="footer-icon">
                                    </div>
                                    <div class="ftt-content">
                                        <p class="mb-0">Email : admin@lonelypro.com</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-sm-6 col-12">
                            <div class="ftt-item">
                                <div class="ftt-inner">
                                    <div class="ftt-thumb">
                                        <img src="/assets/images/footer/icon/03.png" alt="footer-icon">
                                    </div>
                                    <div class="ftt-content">
                                        <p class="mb-0">Address : Beverley, New York 224 US</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="ft-bottom">
                            <div class="row">
                                <div class="col-lg-4 col-md-6">
                                    <div class="footer-widget widget-about">
                                        <h5 class="title text-uppercase">About LONELY PRO</h5>
                                        <p>
                                            LonelyPro is a comprehensive medical laboratory dedicated to providing 
                                            accurate diagnostic testing and health assessment services.
                                        </p>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-6">
                                    <div class="footer-widget widget-blog">
                                        <h5 class="title text-uppercase">Popular Tests</h5>
                                        <ul class="footer-blog">
                                            <% if (tests && tests.length > 0) { %>
                                                <% tests.slice(0, 2).forEach(test => { %>
                                                <li>
                                                    <div class="content">
                                                        <a href="#"><%= test.name %></a>
                                                        <span>$<%= test.price %></span>
                                                    </div>
                                                </li>
                                                <% }); %>
                                            <% } else { %>
                                                <li>
                                                    <div class="content">
                                                        <a href="#">No tests available</a>
                                                        <span>Add tests to get started</span>
                                                    </div>
                                                </li>
                                            <% } %>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-6 pl-xl-4">
                                    <div class="footer-widget widgt-form">
                                        <h5 class="title text-uppercase">Test Updates</h5>
                                        <p>Subscribe to receive updates about new diagnostic tests.</p>
                                        <form class="footer-form">
                                            <input type="email" placeholder="Enter your email" name="email">
                                            <button type="submit">
                                                <span>Subscribe <i class="far fa-paper-plane ml-2"></i></span>
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="container">
                <div class="text-center">
                    <p class="mb-0">&copy; 2023 <a href="/">Lonely Pro Medical Lab</a> - Admin Dashboard v1.0</p>
                </div>
            </div>
        </div>
    </footer>
    <!-- ==========Footer Section Ends Here========== -->
    
    <script src="/assets/js/jquery-3.3.1.min.js"></script>
    <script src="/assets/js/modernizr-3.6.0.min.js"></script>
    <script src="/assets/js/plugins.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/magnific-popup.min.js"></script>
    <script src="/assets/js/jquery.nice-select.min.js"></script>
    <script src="/assets/js/wow.min.js"></script>
    <script src="/assets/js/waypoints.js"></script>
    <script src="/assets/js/odometer.min.js"></script>
    <script src="/assets/js/viewport.jquery.js"></script>
    <script src="/assets/js/slick.min.js"></script>
    <script src="/assets/js/main.js"></script>
    
    <script>
        $(document).ready(function() {
            // Search functionality
            $('#searchTests').on('keyup', function() {
                const searchTerm = $(this).val().toLowerCase();
                const category = $('#filterCategory').val();
                const status = $('#filterStatus').val();
                
                filterTests(searchTerm, category, status);
            });
            
            // Filter functionality
            $('#filterCategory, #filterStatus').change(function() {
                const searchTerm = $('#searchTests').val().toLowerCase();
                const category = $('#filterCategory').val();
                const status = $('#filterStatus').val();
                
                filterTests(searchTerm, category, status);
            });
            
            // Add active class to current menu item
            const currentPath = window.location.pathname;
            $('.menu a').each(function() {
                if ($(this).attr('href') === currentPath) {
                    $(this).addClass('admin-menu-active');
                }
            });
        });
        
        function filterTests(searchTerm, category, status) {
            $('.test-card').each(function() {
                const testName = $(this).find('h5').text().toLowerCase();
                const testCategory = $(this).hasClass(category) || category === '';
                const testStatus = $(this).find('.test-status').text().toLowerCase();
                const statusMatch = status === '' || testStatus === status;
                
                const nameMatch = testName.includes(searchTerm);
                
                if (nameMatch && testCategory && statusMatch) {
                    $(this).parent().show();
                } else {
                    $(this).parent().hide();
                }
            });
        }
        
        function viewTestDetails(testId) {
            // In production, you would fetch this from server via AJAX
            // For now, we'll redirect to view page
            window.location.href = `/admin/view-tests#test-${testId}`;
        }
        
        function confirmDelete() {
            return confirm('Are you sure you want to delete this test? This action cannot be undone.');
        }
        
        // If there are flash messages, show them
        <% if (success_msg && success_msg.length > 0) { %>
            alert('<%= success_msg %>');
        <% } %>
        
        <% if (error_msg && error_msg.length > 0) { %>
            alert('<%= error_msg %>');
        <% } %>
    </script>
</body>
</html>